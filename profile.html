<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Profile</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
  body { margin: 0; font-family: 'Segoe UI', sans-serif; background: #f4f6f8; }

  /* Header */
  header { background: #1e88e5; color: white; padding: 15px; display: flex; align-items: center; gap: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
  .back-btn { font-size: 24px; cursor: pointer; color: white; border: none; background: none; }
  .title { font-size: 20px; font-weight: bold; }

  /* Profile Card */
  .profile-container { padding: 30px 20px; text-align: center; }
  .profile-card {
    background: white; padding: 30px; border-radius: 15px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1); max-width: 400px; margin: 0 auto;
    display: flex; flex-direction: column; align-items: center;
  }
  
  .user-img {
    width: 100px; height: 100px; border-radius: 50%; object-fit: cover;
    border: 4px solid #1e88e5; margin-bottom: 15px;
  }
  
  .user-name { font-size: 22px; font-weight: bold; color: #333; margin-bottom: 5px; }
  .user-email { font-size: 14px; color: #666; margin-bottom: 20px; }

  /* PLAN BADGE STYLES */
  .plan-badge {
    padding: 8px 20px; border-radius: 20px; font-weight: bold; font-size: 14px;
    text-transform: uppercase; letter-spacing: 1px; width: fit-content; margin-top: 10px;
  }

  /* Free Plan Design */
  .plan-free {
    background: #eceff1; color: #546e7a; border: 1px solid #cfd8dc;
  }

  /* Premium Plan Design (Gold) */
  .plan-premium {
    background: #fff8e1; color: #fbc02d; border: 1px solid #fbc02d;
    box-shadow: 0 2px 5px rgba(251, 192, 45, 0.3);
  }

</style>
</head>
<body>

<header>
  <button class="back-btn" onclick="window.history.back()">&#8592;</button>
  <div class="title">My Profile</div>
</header>

<div class="profile-container">
  <div class="profile-card">
    <img id="p-img" src="https://via.placeholder.com/100" class="user-img">
    
    <div id="p-name" class="user-name">Loading...</div>
    <div id="p-email" class="user-email">...</div>
    
    <div id="p-status" class="plan-badge plan-free">Checking Plan...</div>
  </div>
</div>

<script>
  // 1. FIREBASE CONFIG
  const firebaseConfig = {
    apiKey: "AIzaSyBCuefZt2WuNsNiFme8M-HUHm_BZYKJAi4",
    authDomain: "career-care-afb64.firebaseapp.com",
    databaseURL: "https://career-care-afb64-default-rtdb.firebaseio.com",
    projectId: "career-care-afb64",
    appId: "1:267890746286:web:2c38f0980119d01b145e3f"
  };
  if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);

  // 2. LOAD DATA FROM LOCAL STORAGE (Fast Display)
  const localName = localStorage.getItem("userName");
  const localEmail = localStorage.getItem("userEmail");
  const localPic = localStorage.getItem("userPhoto");
  
  if(localName) document.getElementById("p-name").innerText = localName;
  if(localEmail) document.getElementById("p-email").innerText = localEmail;
  if(localPic) document.getElementById("p-img").src = localPic;

  // 3. CHECK PREMIUM STATUS FROM DATABASE
  firebase.auth().onAuthStateChanged((user) => {
    if (user) {
        // Update basic info if changed
        document.getElementById("p-name").innerText = user.displayName;
        document.getElementById("p-email").innerText = user.email;
        if(user.photoURL) document.getElementById("p-img").src = user.photoURL;

        // Check Plan in Database
        const badge = document.getElementById("p-status");
        
        firebase.database().ref("students/" + user.uid).once("value").then(snap => {
            if(snap.exists()){
                const data = snap.val();
                
                // Agar 'isPremium' true hai
                if(data.isPremium === true){
                    badge.innerText = "‚≠ê Premium Member";
                    badge.className = "plan-badge plan-premium";
                } else {
                    // Agar 'isPremium' false ya missing hai
                    badge.innerText = "Free Plan";
                    badge.className = "plan-badge plan-free";
                }
            } else {
                // New User default
                badge.innerText = "Free Plan";
                badge.className = "plan-badge plan-free";
            }
        });
    } else {
        // Not Logged In
        window.location.href = "login.html";
    }
  });
</script>

</body>
</html>
