<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Current Affairs</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
  body { margin: 0; font-family: 'Segoe UI', sans-serif; background: #f4f6f8; }

  /* HEADER */
  header { background: #1e88e5; color: white; padding: 15px; display: flex; align-items: center; gap: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; }
  .back-btn { font-size: 24px; cursor: pointer; color: white; border: none; background: none; }
  .title { font-size: 18px; font-weight: bold; }

  .container { padding: 15px; max-width: 600px; margin: 0 auto; padding-bottom: 50px; }

  /* --- SECTION 1: HOME VIEW (List) --- */
  #home-view { display: block; }

  /* Hero Card (Today's Quiz) */
  .hero-card {
      background: linear-gradient(135deg, #66bb6a, #43a047);
      color: white; padding: 25px; border-radius: 15px;
      text-align: center; cursor: pointer;
      box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
      margin-bottom: 25px; transition: transform 0.2s;
  }
  .hero-card:active { transform: scale(0.98); }
  .hero-title { font-size: 22px; font-weight: bold; margin-bottom: 5px; display: flex; align-items: center; justify-content: center; gap: 10px; }
  .hero-date { font-size: 14px; opacity: 0.9; }

  /* Section Header */
  .section-label { 
      font-size: 16px; font-weight: bold; color: #555; margin-bottom: 10px; 
      border-left: 4px solid #1e88e5; padding-left: 10px; 
  }

  /* List Items */
  .quiz-list-item {
      background: white; padding: 15px; border-radius: 10px;
      margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05); cursor: pointer; border: 1px solid #eee;
  }
  .quiz-list-item:hover { border-color: #bbdefb; background: #f1f8e9; }
  
  .list-date { font-weight: 600; color: #333; display: flex; align-items: center; gap: 8px; }
  .play-btn-small { color: #1e88e5; font-weight: bold; font-size: 14px; }

  /* --- SECTION 2: QUIZ VIEW (Questions) --- */
  #quiz-view { display: none; }
  
  /* Question Card */
  .q-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 20px; }
  .q-text { font-size: 17px; font-weight: 600; color: #333; margin-bottom: 15px; line-height: 1.4; }
  
  .option { padding: 12px 15px; border: 2px solid #eee; border-radius: 8px; margin-bottom: 10px; cursor: pointer; background: #fafafa; }
  .correct { background: #dcedc8 !important; border-color: #7cb342 !important; }
  .wrong { background: #ffcdd2 !important; border-color: #e57373 !important; }
  .hidden-explanation { display: none; margin-top: 10px; padding: 10px; background: #fffde7; border-left: 4px solid #fbc02d; font-size: 14px; }

  /* Loaders */
  #main-loader { text-align: center; margin-top: 50px; font-weight: bold; color: #666; }
</style>
</head>
<body>

<header>
  <button class="back-btn" onclick="handleBack()">&#8592;</button>
  <div class="title">Current Affairs</div>
</header>

<div class="container">

  <div id="main-loader">üîÑ Loading Quizzes...</div>

  <div id="home-view" style="display:none;">
      
      <div id="hero-section" style="display:none;">
          <div class="hero-card" onclick="startLatestQuiz()">
              <div class="hero-title">üöÄ Start Today's Quiz</div>
              <div class="hero-date" id="hero-date-text">Loading...</div>
          </div>
      </div>

      <div class="section-label">üìÖ Previous Quizzes</div>
      <div id="history-list">
          </div>
  </div>

  <div id="quiz-view">
      <h3 id="quiz-title-date" style="text-align:center; color:#444; margin-top:0;">Date</h3>
      <div id="questions-container"></div>
  </div>

</div>

<script>
  /* CONFIG */
  const firebaseConfig = {
    apiKey: "AIzaSyBCuefZt2WuNsNiFme8M-HUHm_BZYKJAi4",
    authDomain: "career-care-afb64.firebaseapp.com",
    databaseURL: "https://career-care-afb64-default-rtdb.firebaseio.com",
    projectId: "career-care-afb64",
    appId: "1:267890746286:web:2c38f0980119d01b145e3f"
  };
  if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);

  let allDates = []; // Store dates

  /* 1. INITIALIZE: Fetch Dates */
  function init() {
      const dbRef = firebase.database().ref('daily_quiz');
      
      // Pichle 30 dino ka data uthao
      dbRef.orderByKey().limitToLast(30).once('value').then(snapshot => {
          document.getElementById("main-loader").style.display = "none";
          document.getElementById("home-view").style.display = "block";

          if(snapshot.exists()){
              const data = snapshot.val();
              // Dates ko sort karo (Latest sabse upar)
              allDates = Object.keys(data).sort().reverse(); 
              
              setupUI(allDates);
          } else {
              document.getElementById("history-list").innerHTML = "<p style='text-align:center'>No quizzes found.</p>";
          }
      });
  }

  /* 2. SETUP UI (Hero + List) */
  function setupUI(dates) {
      if(dates.length > 0) {
          // --- A. SETUP HERO BUTTON (Latest Date) ---
          const latestDate = dates[0];
          document.getElementById("hero-section").style.display = "block";
          document.getElementById("hero-date-text").innerText = formatDateFull(latestDate);
          
          // --- B. SETUP LIST (Remaining Dates) ---
          const listDiv = document.getElementById("history-list");
          listDiv.innerHTML = ""; // Clear

          // Loop through remaining dates (skipping the first one if you want, or show all)
          // Yahan hum second date se shuru karenge taki duplication na ho, ya sab dikha sakte hain.
          // User ke image me "Previous" alag hai, to hum index 1 se start karte hain.
          
          const previousDates = dates.slice(1); 
          
          if(previousDates.length === 0) {
              listDiv.innerHTML = "<p style='text-align:center; color:#999; font-size:14px;'>No previous history.</p>";
          }

          previousDates.forEach(date => {
              const item = document.createElement("div");
              item.className = "quiz-list-item";
              item.innerHTML = `
                  <div class="list-date">üìÖ ${formatDateShort(date)}</div>
                  <div class="play-btn-small">Play ‚ñ∂</div>
              `;
              item.onclick = () => loadQuiz(date);
              listDiv.appendChild(item);
          });
      }
  }

  /* 3. START QUIZ FUNCTIONS */
  function startLatestQuiz() {
      if(allDates.length > 0) loadQuiz(allDates[0]);
  }

  function loadQuiz(dateKey) {
      // UI Switch
      document.getElementById("home-view").style.display = "none";
      document.getElementById("quiz-view").style.display = "block";
      document.getElementById("quiz-title-date").innerText = formatDateFull(dateKey);
      document.getElementById("questions-container").innerHTML = "<p style='text-align:center'>Loading Questions...</p>";

      // Fetch Questions
      firebase.database().ref(`daily_quiz/${dateKey}`).once('value').then(snap => {
          const qContainer = document.getElementById("questions-container");
          qContainer.innerHTML = ""; // Clear loader

          if(snap.exists() && snap.val().questions) {
              renderQuestions(snap.val().questions, qContainer);
          } else {
              qContainer.innerHTML = "<p>No questions found for this date.</p>";
          }
      });
  }

  /* 4. RENDER QUESTIONS (Standard Logic) */
  function renderQuestions(questions, container) {
      const qArray = Array.isArray(questions) ? questions : Object.values(questions);
      
      qArray.forEach((q, index) => {
          const card = document.createElement("div");
          card.className = "q-card";
          
          let html = `<div class="q-text">Q${index+1}. ${q.question}</div>`;
          if(q.options) {
              q.options.forEach((opt, i) => {
                  html += `<div class="option" onclick="check(this, ${i}, ${q.correctAnswer}, 'expl-${index}')">${opt}</div>`;
              });
          }
          html += `<div id="expl-${index}" class="hidden-explanation"><b>üí° Logic:</b> ${q.explanation || "N/A"}</div>`;
          card.innerHTML = html;
          container.appendChild(card);
      });
  }

  window.check = function(btn, selected, correct, explId) {
      if(btn.parentElement.classList.contains("answered")) return;
      const parent = btn.parentElement;
      parent.classList.add("answered");
      const opts = parent.querySelectorAll(".option");

      if(selected == correct) {
          btn.classList.add("correct");
          btn.innerHTML += " ‚úÖ";
      } else {
          btn.classList.add("wrong");
          btn.innerHTML += " ‚ùå";
          opts[correct].classList.add("correct");
          opts[correct].innerHTML += " ‚úÖ";
      }
      document.getElementById(explId).style.display = "block";
  };

  /* 5. NAVIGATION & FORMATTING */
  function handleBack() {
      const quizView = document.getElementById("quiz-view");
      if(quizView.style.display === "block") {
          // Agar Quiz khula hai, to List par wapas jao
          quizView.style.display = "none";
          document.getElementById("home-view").style.display = "block";
      } else {
          // Agar List par hain, to Home (Index) par jao
          window.location.href = "index.html";
      }
  }

  function formatDateFull(dateStr) {
      const d = new Date(dateStr);
      return d.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
  }

  function formatDateShort(dateStr) {
      const d = new Date(dateStr);
      return d.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
  }

  // Run
  init();

</script>

</body>
</html>
