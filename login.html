<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Career Care Login</title>
<script src="firebase.js"></script>
<style>
body{font-family:Arial;background:#f4f6f8;padding:12px}
input{padding:10px;margin:6px 0;border-radius:6px;width:200px}
button{padding:10px 14px;margin:5px;border:none;border-radius:6px;cursor:pointer}
</style>
</head>
<body>

<h2>Login with OTP</h2>

<div id="loginDiv">
  <input type="text" id="mobile" placeholder="Enter Mobile +91" maxlength="10"><br>
  <div id="recaptcha-container"></div>
  <button onclick="sendOTP()">Send OTP</button>
</div>

<div id="otpDiv" style="display:none">
  <input type="text" id="otp" placeholder="Enter OTP" maxlength="6"><br>
  <button onclick="verifyOTP()">Verify OTP</button>
</div>

<script>
let confirmationResult;

function sendOTP(){
  let mobile = document.getElementById("mobile").value;
  if(mobile.length != 10){ alert("Enter valid mobile"); return; }

  window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container',{
    size: 'invisible'
  });

  firebase.auth().signInWithPhoneNumber("+91"+mobile, window.recaptchaVerifier)
  .then(function(result){
    confirmationResult = result;
    alert("OTP sent!");
    document.getElementById("loginDiv").style.display="none";
    document.getElementById("otpDiv").style.display="block";
  }).catch(function(error){
    alert(error.message);
  });
}

function verifyOTP(){
  let code = document.getElementById("otp").value;
  confirmationResult.confirm(code).then(function(result){
    let user = result.user;
    alert("Login Successful");
    
    // Save user mobile & UID to Firebase
    firebase.database().ref("students/"+user.phoneNumber.replace("+91","")).set({
      uid: user.uid,
      mobile: user.phoneNumber
    });

    // Redirect to home or test page
    window.location = "index.html?mobile="+user.phoneNumber.replace("+91","");
  }).catch(function(error){
    alert("Invalid OTP: "+error.message);
  });
}
</script>

</body>
</html>
