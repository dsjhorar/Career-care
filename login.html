<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Login - Career Care</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
  body{
    font-family: 'Segoe UI', sans-serif; 
    background: #f0f2f5; 
    display: flex; 
    justify-content: center; 
    align-items: center; 
    height: 100vh; 
    margin: 0;
  }
  .login-card {
    background: white; 
    padding: 40px; 
    border-radius: 12px; 
    box-shadow: 0 5px 15px rgba(0,0,0,0.1); 
    text-align: center; 
    width: 90%; 
    max-width: 350px;
  }
  .app-logo {
    width: 80px; 
    margin-bottom: 20px;
  }
  h2 { color: #333; margin-bottom: 5px; }
  p { color: #666; margin-bottom: 30px; }
  
  .google-btn {
    background: white;
    color: #444;
    border: 1px solid #ddd;
    border-radius: 6px;
    padding: 12px;
    width: 100%;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    transition: 0.2s;
  }
  .google-btn:hover { background: #f8f9fa; border-color: #ccc; }
  .google-btn img { width: 20px; }
</style>
</head>
<body>

<div class="login-card">
  <img src="logo.png" alt="Logo" class="app-logo" onerror="this.src='https://via.placeholder.com/80?text=App'">
  <h2>Welcome Back</h2>
  <p>Start your exam preparation journey</p>

  <button class="google-btn" onclick="googleLogin()">
    <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" alt="G">
    Sign in with Google
  </button>
</div>

<script>
/* ================= CONFIGURATION ================= */
const firebaseConfig = {
  apiKey: "AIzaSyBCuefZt2WuNsNiFme8M-HUHm_BZYKJAi4",
  authDomain: "career-care-afb64.firebaseapp.com",
  databaseURL: "https://career-care-afb64-default-rtdb.firebaseio.com",
  projectId: "career-care-afb64",
  storageBucket: "career-care-afb64.firebasestorage.app",
  messagingSenderId: "267890746286",
  appId: "1:267890746286:web:2c38f0980119d01b145e3f"
};
// Initialize Firebase
if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);

function googleLogin() {
    const provider = new firebase.auth.GoogleAuthProvider();
    
    firebase.auth().signInWithPopup(provider)
    .then((result) => {
        const user = result.user;
        checkUserInDatabase(user);
    }).catch((error) => {
        alert("Login Failed: " + error.message);
    });
}

function checkUserInDatabase(user) {
    // Ab hum User ID (UID) use karenge jo unique hoti hai
    const userRef = firebase.database().ref("students/" + user.uid);
    
    userRef.once('value').then(snapshot => {
        if (snapshot.exists()) {
            // --- OLD USER ---
            let data = snapshot.val();
            saveLocalAndRedirect(user.uid, data.isPremium);
        } else {
            // --- NEW USER ---
            // Naya data save karein (isPremium: false)
            userRef.set({
                uid: user.uid,
                name: user.displayName,
                email: user.email,
                photo: user.photoURL,
                isPremium: false, // FREE USER
                joinDate: new Date().toISOString()
            }).then(() => {
                saveLocalAndRedirect(user.uid, false);
            });
        }
    });
}

function saveLocalAndRedirect(uid, isPremium) {
    localStorage.setItem("userUid", uid); // Phone ki jagah UID save kar rahe hain
    localStorage.setItem("isPremium", isPremium);
    window.location.href = "index.html";
}
</script>

</body>
</html>
