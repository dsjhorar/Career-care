<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Login - Career Care</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
  body { font-family: sans-serif; background: #f0f2f5; display: flex; height: 100vh; justify-content: center; align-items: center; margin: 0; }
  .login-card { background: white; padding: 30px; border-radius: 12px; text-align: center; width: 90%; max-width: 350px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
  .btn { background: white; border: 1px solid #ccc; padding: 12px; width: 100%; font-weight: bold; cursor: pointer; border-radius: 5px; margin-top: 20px; display: flex; justify-content: center; align-items: center; gap: 10px; }
  .btn:hover { background: #f9f9f9; }
  #status { margin-top: 15px; font-size: 14px; color: #666; }
  #error-msg { color: red; font-size: 13px; margin-top: 10px; display: none; background: #ffebee; padding: 5px; border-radius: 4px; }
</style>
</head>
<body>

<div class="login-card">
  <h2>Welcome</h2>
  <p>Please login to continue</p>
  
  <button id="loginBtn" class="btn" onclick="startLogin()">
     <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20"> 
     Sign in with Google
  </button>
  
  <div id="status">Wait...</div>
  <div id="error-msg"></div>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBCuefZt2WuNsNiFme8M-HUHm_BZYKJAi4",
    authDomain: "career-care-afb64.firebaseapp.com",
    databaseURL: "https://career-care-afb64-default-rtdb.firebaseio.com",
    projectId: "career-care-afb64",
    appId: "1:267890746286:web:2c38f0980119d01b145e3f"
  };
  if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);

  const statusDiv = document.getElementById("status");
  const loginBtn = document.getElementById("loginBtn");
  const errorDiv = document.getElementById("error-msg");

  // 1. Check Login Status on Load
  firebase.auth().onAuthStateChanged((user) => {
    if (user) {
        statusDiv.innerText = "Login Found! Redirecting...";
        loginBtn.style.display = "none";
        
        // Save UID and Go to Home
        localStorage.setItem("userUid", user.uid);
        window.location.href = "index.html";
    } else {
        statusDiv.innerText = "Please click the button to login.";
        loginBtn.style.display = "flex";
    }
  });

  // 2. Login Function (POPUP wala)
  function startLogin() {
    statusDiv.innerText = "Opening Google Popup...";
    errorDiv.style.display = "none";

    var provider = new firebase.auth.GoogleAuthProvider();
    
    // Popup use kar rahe hain taaki error dikh sake
    firebase.auth().signInWithPopup(provider)
    .then((result) => {
        statusDiv.innerText = "Success! Entering App...";
        // onAuthStateChanged apne aap redirect handle karega
    })
    .catch((error) => {
        console.error("Login Failed:", error);
        statusDiv.innerText = "Login Failed.";
        
        // Error screen par dikhao
        errorDiv.style.display = "block";
        errorDiv.innerText = "Error: " + error.message;
        
        // Agar Domain ka error hai to saaf batao
        if(error.code === "auth/unauthorized-domain") {
            alert("⚠️ Domain Error!\nAapne Firebase Console mein 'dsjhorar.github.io' add nahi kiya hai.");
        } else {
            alert("❌ Error: " + error.message);
        }
    });
  }
</script>

</body>
</html>
