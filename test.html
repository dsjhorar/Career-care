<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Career Care Test</title>

<script src="firebase.js"></script>

<style>
body{font-family:Arial;background:#f4f6f8;padding:10px}
.option{background:#fff;padding:12px;margin:8px 0;border-radius:8px;border:1px solid #ddd;cursor:pointer}
.option.selected{background:#cceeff}
.option.correct{background:#b6f2c1}
.option.wrong{background:#f7b2b2}
button{padding:10px;margin:5px;border:none;border-radius:6px;font-weight:bold}
#explanation{display:none;background:#fff;padding:10px;border-radius:6px;margin-top:10px}
</style>
</head>

<body>

<h2 id="title">Loading...</h2>
<p>⏱ <span id="timer">00:00</span></p>

<h3 id="question"></h3>
<div id="options"></div>

<button onclick="prevQ()">⬅ Back</button>
<button onclick="skipQ()">⏭ Skip</button>
<button onclick="nextQ()">Next ➡</button>
<button onclick="submitTest()">Submit</button>

<div id="explanation"></div>
<h3 id="score"></h3>

<script>
/* URL PARAMS */
const p = new URLSearchParams(location.search);
const exam = p.get("exam");
const type = p.get("type");
const topic = p.get("topic");

let path = `tests/${exam}/${topic}/questions`;

let questions=[],answers={},current=0,submitted=false,score=0;
let sec=0;

setInterval(()=>{
 sec++;
 document.getElementById("timer").innerText=
 String(Math.floor(sec/60)).padStart(2,"0")+":"+
 String(sec%60).padStart(2,"0");
},1000);

/* LOAD QUESTIONS */
firebase.database().ref(path).once("value",snap=>{
 snap.forEach(c=>questions.push(c.val()));
 document.getElementById("title").innerText =
 exam.replace("_"," ").toUpperCase()+" Test";
 loadQ();
});

function loadQ(){
 let q=questions[current];
 document.getElementById("question").innerText=(current+1)+". "+q.q;
 let html="";
 Object.keys(q.options).forEach(i=>{
  let cls="option";
  if(answers[current]==i)cls+=" selected";
  if(submitted){
   if(i==q.answer)cls+=" correct";
   else if(answers[current]==i)cls+=" wrong";
  }
  html+=`<div class="${cls}" onclick="selectOpt(${i})">${q.options[i]}</div>`;
 });
 document.getElementById("options").innerHTML=html;

 if(submitted){
  document.getElementById("explanation").style.display="block";
  document.getElementById("explanation").innerHTML="<b>Explanation:</b> "+q.explanation;
 }
}

function selectOpt(i){if(!submitted){answers[current]=i;loadQ();}}
function nextQ(){if(current<questions.length-1){current++;loadQ();}}
function prevQ(){if(current>0){current--;loadQ();}}
function skipQ(){nextQ();}

function submitTest(){
 submitted=true;score=0;
 questions.forEach((q,i)=>{
  if(answers[i]!=null){
   if(answers[i]==q.answer)score+=1;
   else score-=0.33;
  }
 });
 document.getElementById("score").innerText="Final Score: "+score.toFixed(2);
 loadQ();
}
</script>

</body>
</html>
