<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>Online Test</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body { font-family: Arial; padding: 15px; background:#f5f7fa; }

h2 { color:#333; }

.option {
  padding: 12px;
  margin: 8px 0;
  border-radius: 6px;
  border: 1px solid #aaa;
  cursor: pointer;
  background:#fff;
}

.option:hover { background:#f1f1f1; }

.selected { background:#87CEFA; }     /* Sky Blue */
.correct { background:#9cff9c; }
.wrong { background:#ff9c9c; }

.btn {
  padding: 10px 15px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  margin: 5px;
  color:#fff;
}

.back { background:#6c757d; }
.next { background:#007bff; }
.skip { background:#ffc107; color:#000; }
.submit { background:#28a745; }

#timer { font-size:18px; font-weight:bold; }
</style>
</head>

<body>

<h2>Test</h2>
<div id="timer">00:00</div>
<hr>

<div id="question"></div>
<div id="options"></div>

<hr>
<button class="btn back" onclick="prevQ()">Back</button>
<button class="btn skip" onclick="skipQ()">Skip</button>
<button class="btn next" onclick="nextQ()">Next</button>
<button class="btn submit" onclick="submitTest()">Submit</button>

<script>
/* ================= FIREBASE ================= */
var firebaseConfig = {
  apiKey: "AIzaSyBCuefZt2WuNsNiFme8M-HUHm_BZYKJAi4",
  authDomain: "career-care-afb64.firebaseapp.com",
  databaseURL: "https://career-care-afb64-default-rtdb.firebaseio.com",
  projectId: "career-care-afb64",
};
firebase.initializeApp(firebaseConfig);
var db = firebase.database();

/* ================= VARIABLES ================= */
let questions = [];
let index = 0;
let answers = [];
let score = 0;
let time = 0;
const NEGATIVE = 1/3;

/* ================= TIMER ================= */
setInterval(() => {
  time++;
  document.getElementById("timer").innerText =
    new Date(time * 1000).toISOString().substr(14, 5);
}, 1000);

/* ================= LOAD QUESTIONS ================= */
db.ref("tests/first_grade/topic_intro/questions")
.once("value", snapshot => {
  let data = snapshot.val();

  questions = Object.keys(data).map(key => {
    return {
      question: data[key].q,
      options: Object.values(data[key].options),
      answer: data[key].answer,
      explanation: data[key].explanation
    };
  });

  showQuestion();
});

/* ================= SHOW QUESTION ================= */
function showQuestion() {
  let q = questions[index];

  document.getElementById("question").innerHTML =
    `<b>Q${index + 1}.</b> ${q.question}`;

  let optDiv = document.getElementById("options");
  optDiv.innerHTML = "";

  q.options.forEach((opt, i) => {
    let div = document.createElement("div");
    div.className = "option";
    div.innerText = opt;

    if (answers[index]?.selected === i)
      div.classList.add("selected");

    div.onclick = () => selectOption(i);
    optDiv.appendChild(div);
  });
}

/* ================= SELECT ================= */
function selectOption(i) {
  answers[index] = { selected: i, skipped: false };
  showQuestion();
}

/* ================= NAVIGATION ================= */
function nextQ() {
  if (index < questions.length - 1) {
    index++;
    showQuestion();
  }
}

function prevQ() {
  if (index > 0) {
    index--;
    showQuestion();
  }
}

function skipQ() {
  answers[index] = { selected: null, skipped: true };
  nextQ();
}

/* ================= SUBMIT ================= */
function submitTest() {
  score = 0;

  questions.forEach((q, i) => {
    let a = answers[i];
    if (!a || a.skipped) return;
    if (a.selected === q.answer) score += 1;
    else score -= NEGATIVE;
  });

  showResult();
}

/* ================= RESULT ================= */
function showResult() {
  let html = `<h2>Result</h2>`;
  html += `<p><b>Score:</b> ${score.toFixed(2)}</p><hr>`;

  questions.forEach((q, i) => {
    html += `<p><b>Q${i+1}.</b> ${q.question}</p>`;

    q.options.forEach((opt, j) => {
      let cls = "";
      if (j === q.answer) cls = "correct";
      if (answers[i]?.selected === j && j !== q.answer) cls = "wrong";
      html += `<div class="option ${cls}">${opt}</div>`;
    });

    html += `<i>Explanation:</i> ${q.explanation}<hr>`;
  });

  document.body.innerHTML = html;
}
</script>

</body>
</html>
